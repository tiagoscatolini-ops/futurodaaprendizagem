# Bloco C — Gerar index.html (Template seguro) com carrossel e LinkedIn | título branco
import os, base64, mimetypes
from string import Template
from IPython.display import HTML, display

# ========= CONFIGURAÇÕES =========
AMAZON_URL   = "https://www.amazon.com.br/"          # troque pelo link real
LINKEDIN_URL = "https://www.linkedin.com/in/tiagoscatolini/"

# (Opcional) Informe nomes exatos; se vazio, detecta automaticamente.
AUTHOR_FILE = ""   # ex: "WhatsApp Image 2024-12-04 at 08.10.54.jpeg"
HERO_FILE   = ""   # ex: "hero-fundo.png"
COVER_FILE  = ""   # ex: "capa.png"
PDF_FILE    = ""   # ex: "preview_capitulo.pdf"

# ========= FUNÇÕES =========
def to_data_uri(path):
    if not path or not os.path.exists(path): 
        return ""
    mime, _ = mimetypes.guess_type(path)
    if not mime: 
        return ""
    with open(path, "rb") as f:
        b64 = base64.b64encode(f.read()).decode("utf-8")
    return f"data:{mime};base64,{b64}"

def pick_by_keywords(files, *keywords):
    cand = [f for f in files if any(k in f.lower() for k in keywords)]
    if cand:
        cand.sort(key=lambda x: os.path.getmtime(os.path.join("/content", x)))
        return cand[-1]
    return ""

def pick_largest(files, exclude=set()):
    cand = [f for f in files if f not in exclude]
    if not cand: 
        return ""
    return max(cand, key=lambda f: os.path.getsize(os.path.join("/content", f)))

# ========= COLETA DE ARQUIVOS =========
uploaded = set(os.listdir("/content"))
img_files = [f for f in uploaded if f.lower().endswith((".png",".jpg",".jpeg"))]
pdf_files = [f for f in uploaded if f.lower().endswith(".pdf")]

if not AUTHOR_FILE and img_files:
    AUTHOR_FILE = pick_by_keywords(img_files, "whatsapp", "author", "perfil") or pick_largest(img_files)
if not HERO_FILE and img_files:
    HERO_FILE = pick_by_keywords(img_files, "hero", "fundo", "background") or pick_largest(img_files, exclude={AUTHOR_FILE})
if not COVER_FILE and img_files:
    COVER_FILE = pick_by_keywords(img_files, "capa", "cover", "book") or pick_largest(img_files, exclude={AUTHOR_FILE, HERO_FILE})
if not PDF_FILE and pdf_files:
    PDF_FILE = pdf_files[-1]

# ========= DATA URI =========
author_photo = to_data_uri(os.path.join("/content", AUTHOR_FILE)) if AUTHOR_FILE else ""
hero_bg      = to_data_uri(os.path.join("/content", HERO_FILE))   if HERO_FILE   else ""
cover_art    = to_data_uri(os.path.join("/content", COVER_FILE))  if COVER_FILE  else ""
pdf_preview  = to_data_uri(os.path.join("/content", PDF_FILE))    if PDF_FILE    else ""

special = {x for x in [AUTHOR_FILE, HERO_FILE, COVER_FILE, PDF_FILE] if x}
carousel_files = [f for f in img_files if f not in special]
carousel_files.sort(key=lambda x: os.path.getsize(os.path.join("/content", x)), reverse=True)
carousel_imgs = [to_data_uri(os.path.join("/content", f)) for f in carousel_files]

# ========= PARTES CONDICIONAIS =========
opacity_val     = "0.20" if hero_bg else "1"
hero_img_tag    = f'<img class="hero-art" src="{cover_art}" alt="Capa do livro">' if cover_art else ""
author_img_tag  = f'<img src="{author_photo}" alt="Foto de Tiago Scatolini">' if author_photo else ""
pdf_btn         = f"<a class='btn btn-muted' href='{pdf_preview}' download='Primeiro_Capitulo_Preview.pdf'>Baixar prévia (PDF)</a>" if pdf_preview else ""
carousel_cards  = "".join([f'<div class="card"><img src="{img}" alt="Mockup do livro"></div>' for img in carousel_imgs])

LINKEDIN_SVG = """<svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" aria-hidden="true"><path d="M20.45 20.45h-3.55v-5.6c0-1.34-.02-3.07-1.87-3.07-1.88 0-2.17 1.47-2.17 2.98v5.69H9.31V9h3.41v1.56h.05c.47-.9 1.62-1.85 3.34-1.85 3.58 0 4.24 2.35 4.24 5.41v6.33zM5.34 7.43a2.06 2.06 0 1 1 0-4.12 2.06 2.06 0 0 1 0 4.12zM7.11 20.45H3.57V9h3.54v11.45z"/></svg>"""

# ========= TEMPLATE HTML/CSS =========
tpl = Template(r"""<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>O Futuro da Aprendizagem | Tiago Scatolini</title>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary:#0071E3; --secondary:#1D1D1F; --light:#F5F5F7; --muted:#86868B; --white:#fff;
}
/* Textos mais escuros */
* { box-sizing:border-box; }
body { margin:0; background:var(--light); color:#0E1116; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; line-height:1.7; }
h1,h2,h3 { font-family:Montserrat,Inter,sans-serif; margin:.2em 0 .5em; line-height:1.1; color:#0B0D10; }
a { color:var(--primary); text-decoration:none; } a:hover { text-decoration:underline; }

/* Hero */
.hero { position:relative; min-height:88vh; color:#fff; display:flex; align-items:center;
         background: radial-gradient(120% 120% at 70% 10%, #0b1220 0%, #0a0f18 50%, #07090d 100%); }
.hero::before { content:""; position:absolute; inset:0; background: url('$hero_bg') center/cover no-repeat; opacity:$opacity_val; }
.hero-inner { position:relative; z-index:2; max-width:1200px; margin:0 auto; padding:clamp(1.2rem,3vw,3rem);
              display:grid; grid-template-columns:1.2fr 1fr; gap:clamp(1rem,3vw,3rem); }
.hero-title { font-size: clamp(2.2rem, 3vw + 1.2rem, 4rem); margin:0 0 .6rem; color:#ffffff; } /* ← branco forçado */
.hero-sub { font-size: clamp(1.1rem, 1vw + .8rem, 1.6rem); color:#d9dee6; margin:.2rem 0 1.6rem; }

.btn { display:inline-flex; align-items:center; gap:.55rem; padding:.9rem 1.4rem; border-radius:999px; font-weight:700;
       border:1px solid transparent; text-decoration:none; transition:opacity .15s, background .2s; }
.btn-primary { background:var(--primary); color:#fff; } .btn-primary:hover{ opacity:.92; }
.btn-muted { background:#2a2d33; color:#fff; border-color:#36404c; } .btn-muted:hover{ background:#303540; }
.btn-ghost { background:transparent; color:#fff; border:1px solid #445265; } .btn-ghost:hover{ background:rgba(255,255,255,.06); }
.btn svg { width:18px; height:18px; display:block; }

.hero-ctas { display:flex; gap:12px; flex-wrap:wrap; }
.hero-art { align-self:center; justify-self:center; width:min(90%, 520px); filter: drop-shadow(0 24px 40px rgba(0,0,0,.45)); border-radius:14px; }

/* Carrossel */
.gallery { max-width:1200px; margin:24px auto 32px; padding:0 20px; }
.scroller { display:flex; gap:16px; overflow-x:auto; scroll-snap-type:x mandatory; padding-bottom:8px; }
.scroller::-webkit-scrollbar { height:10px; } .scroller::-webkit-scrollbar-thumb { background:#cfd2d8; border-radius:10px; }
.card { min-width:320px; max-width:420px; flex:0 0 auto; scroll-snap-align:start; background:#fff; border-radius:16px; padding:10px; box-shadow:0 10px 30px rgba(0,0,0,.12); }
.card img { width:100%; height:auto; border-radius:12px; display:block; }

/* Conteúdo */
.container { max-width:1100px; margin:32px auto; padding:0 20px; }
.section-title { font-size: clamp(1.6rem, 2vw + .6rem, 2.4rem); text-align:center; margin: 18px 0; color:#0B0D10; }
.lead { text-align:center; color:#0F141B; max-width:840px; margin:0 auto 26px; }

.features { display:grid; gap:18px; grid-template-columns: repeat(auto-fit, minmax(260px,1fr)); margin-top:16px; }
.feature { background:#fff; padding:18px; border-radius:14px; box-shadow:0 8px 20px rgba(0,0,0,.08); }
.feature h3 { margin:.3rem 0 .4rem; font-size:1.15rem; color:#0B0D10; }
.feature p{ margin:0; color:#0E1116; }

.author { display:grid; grid-template-columns:160px 1fr; gap:18px; align-items:center; background:#fff; padding:18px; border-radius:16px; box-shadow:0 10px 28px rgba(0,0,0,.08); max-width:900px; margin:24px auto 0; }
.author img { width:160px; height:160px; border-radius:50%; object-fit:cover; border:4px solid #eef1f6; box-shadow:0 8px 18px rgba(0,0,0,.12); }
.author h3 { margin:.1rem 0 .3rem; color:#0B0D10; }
.author p{ margin:.3rem 0; color:#0E1116; }

.cta { text-align:center; background:#fff; padding:28px; border-radius:16px; box-shadow:0 10px 28px rgba(0,0,0,.08); margin-top:26px; color:#0E1116; }
footer { margin-top:36px; padding:18px 10px; text-align:center; color:#161A20; }

@media (max-width:940px) {
  .hero-inner { grid-template-columns:1fr; text-align:center; }
  .hero-ctas { justify-content:center; }
  .hero-art { width:min(90%, 460px); }
  .author { grid-template-columns:1fr; text-align:center; }
}
</style>
</head>
<body>

<section class="hero">
  <div class="hero-inner">
    <div>
      <h1 class="hero-title">O Futuro da Aprendizagem</h1>
      <p class="hero-sub">Inteligência Artificial e os Caminhos da Educação 5.0</p>
      <div class="hero-ctas">
        <a class="btn btn-primary" href="$AMAZON_URL" target="_blank" rel="noopener noreferrer">Comprar na Amazon</a>
        $pdf_btn
        <a class="btn btn-ghost" href="$LINKEDIN_URL" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn de Tiago Scatolini">
          $LINKEDIN_SVG
          Ver perfil no LinkedIn
        </a>
      </div>
    </div>
    $hero_img_tag
  </div>
</section>

<section class="gallery">
  <div class="scroller">
    $carousel_cards
  </div>
</section>

<main class="container">
  <h2 class="section-title">Um Guia Essencial para o Futuro Educacional</h2>
  <p class="lead">
    Estratégias concretas para preparar alunos e instituições, explorar o potencial da IA em experiências
    mais eficientes e envolventes e tomar decisões baseadas em evidências com segurança e ética.
  </p>

  <section class="features">
    <div class="feature"><h3>IA no cotidiano</h3><p>Fluxos, ferramentas e estudos de caso para sala de aula e gestão.</p></div>
    <div class="feature"><h3>Educação 5.0</h3><p>Tecnologia com propósito humano e indicadores de aprendizagem.</p></div>
    <div class="feature"><h3>Ética & dados</h3><p>Diretrizes simples para uso responsável de modelos e informações.</p></div>
  </section>

  <section class="author">
    $author_img_tag
    <div>
      <h3>Tiago Scatolini</h3>
      <p><b>MSc. Ciência Política</b>, especialista em Ciência de dados e Inteligência artificial, graduado em Ciências biológicas.</p>
      <a class="btn btn-muted" href="$LINKEDIN_URL" target="_blank" rel="noopener noreferrer">
        $LINKEDIN_SVG
        Ver perfil no LinkedIn
      </a>
    </div>
  </section>

  <section class="cta">
    <h3>Garanta sua cópia agora mesmo!</h3>
    <p>O livro que vai revolucionar sua visão sobre o futuro da educação.</p>
    <div class="hero-ctas" style="justify-content:center;">
      <a class="btn btn-primary" href="$AMAZON_URL" target="_blank" rel="noopener noreferrer">Comprar na Amazon</a>
      $pdf_btn
    </div>
  </section>
</main>

<footer><small>&copy; 2025 Tiago Scatolini. Todos os direitos reservados.</small></footer>
</body></html>
""")

html_code = tpl.substitute(
    AMAZON_URL=AMAZON_URL,
    LINKEDIN_URL=LINKEDIN_URL,
    LINKEDIN_SVG=LINKEDIN_SVG,
    hero_bg=hero_bg,
    opacity_val=opacity_val,
    hero_img_tag=hero_img_tag,
    author_img_tag=author_img_tag,
    pdf_btn=pdf_btn,
    carousel_cards=carousel_cards
)

with open("index.html", "w", encoding="utf-8") as f:
    f.write(html_code)

print("✔️  index.html gerado com sucesso!")
display(HTML(html_code))

# download (Colab)
try:
    from google.colab import files as colab_files
    colab_files.download("index.html")
except Exception:
    pass
